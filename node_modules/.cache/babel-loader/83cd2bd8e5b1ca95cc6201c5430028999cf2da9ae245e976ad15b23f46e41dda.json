{"ast":null,"code":"import _objectSpread from\"/Users/aj.didonato/Desktop/requestr/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{useNavigate}from'react-router-dom';import{useAuth}from'../../hooks/useAuth';import{requestsAPI}from'../../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const ArtistDashboard=()=>{const[requests,setRequests]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[actionLoading,setActionLoading]=useState({});const{artist,logout,isAuthenticated}=useAuth();const navigate=useNavigate();const loadRequests=useCallback(async()=>{if(!artist)return;try{setLoading(true);const response=await requestsAPI.getByArtist(artist.username,'all');setRequests(response.data);setError('');}catch(err){setError('Failed to load requests');console.error('Error loading requests:',err);}finally{setLoading(false);}},[artist]);// Redirect if not authenticated\nuseEffect(()=>{if(!isAuthenticated()){navigate('/artist/login');return;}loadRequests();},[isAuthenticated,navigate,loadRequests]);const handleStatusUpdate=async(requestId,newStatus)=>{setActionLoading(prev=>_objectSpread(_objectSpread({},prev),{},{[requestId]:true}));try{await requestsAPI.update(requestId,{status:newStatus});await loadRequests();// Reload to get updated queue\n}catch(err){console.error('Error updating request:',err);alert('Failed to update request status');}finally{setActionLoading(prev=>_objectSpread(_objectSpread({},prev),{},{[requestId]:false}));}};const handleDelete=async requestId=>{if(!window.confirm('Are you sure you want to delete this request?')){return;}setActionLoading(prev=>_objectSpread(_objectSpread({},prev),{},{[requestId]:true}));try{await requestsAPI.delete(requestId);await loadRequests();// Reload to get updated queue\n}catch(err){console.error('Error deleting request:',err);alert('Failed to delete request');}finally{setActionLoading(prev=>_objectSpread(_objectSpread({},prev),{},{[requestId]:false}));}};const handleLogout=()=>{logout();navigate('/');};const formatTime=dateString=>{const date=new Date(dateString);return date.toLocaleString();};const formatTip=amount=>{if(!amount)return null;return\"$\".concat(amount.toFixed(2));};// Removed unused getStatusColor function\nconst pendingRequests=requests.filter(req=>req.status==='pending');const completedRequests=requests.filter(req=>req.status==='completed');const totalTips=requests.filter(req=>req.tip_amount).reduce((sum,req)=>sum+req.tip_amount,0);if(!artist){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"container\",style:{paddingBottom:'80px'},children:/*#__PURE__*/_jsxs(\"div\",{className:\"safe-area-top\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mt-6 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"mb-2\",children:\"\\uD83C\\uDFA4 Dashboard\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 mb-0\",children:[\"Welcome back, \",artist.display_name,\"!\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,className:\"btn btn-sm btn-secondary\",children:\"Logout\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-primary-color mb-2\",children:pendingRequests.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Pending Requests\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-green-600 mb-2\",children:completedRequests.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Completed\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-secondary-color mb-2\",children:[\"$\",totalTips.toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Total Tips\"})]})})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 p-4 bg-red-50 border border-red-200 rounded-md\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-red-800 mb-0\",children:[\"\\u274C \",error]})}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loading requests...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"mb-0\",children:[\"Pending Requests (\",pendingRequests.length,\")\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:loadRequests,className:\"btn btn-sm btn-secondary\",disabled:loading,children:\"\\uD83D\\uDD04 Refresh\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:pendingRequests.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-4\",children:\"No pending requests\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-400\",children:[\"Share your username: \",/*#__PURE__*/_jsxs(\"strong\",{children:[\"@\",artist.username]})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:pendingRequests.map(request=>/*#__PURE__*/_jsxs(\"div\",{className:\"border border-gray-200 rounded-lg p-4 bg-white\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center justify-center w-8 h-8 bg-primary-color text-white text-sm font-medium rounded-full mr-3\",children:request.queue_position}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900 mb-1\",children:request.song_title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[\"by \",request.song_artist]})]})]}),request.tip_amount&&/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-medium text-green-600\",children:formatTip(request.tip_amount)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 mb-1\",children:[\"Requested by \",/*#__PURE__*/_jsx(\"strong\",{children:request.requester_name})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:formatTime(request.created_at)})]}),request.message&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-gray-50 rounded-md\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-700 mb-0\",children:[\"\\\"\",request.message,\"\\\"\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleStatusUpdate(request.id,'completed'),className:\"btn btn-sm btn-success\",disabled:actionLoading[request.id],children:actionLoading[request.id]?/*#__PURE__*/_jsx(\"span\",{className:\"loading\"}):'âœ… Mark Complete'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(request.id),className:\"btn btn-sm btn-error\",disabled:actionLoading[request.id],children:actionLoading[request.id]?/*#__PURE__*/_jsx(\"span\",{className:\"loading\"}):'ðŸ—‘ï¸ Delete'})]})]},request.id))})})]}),completedRequests.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsxs(\"h3\",{className:\"mb-0\",children:[\"Recently Completed (\",completedRequests.length,\")\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:completedRequests.slice(-10).reverse().map(request=>/*#__PURE__*/_jsx(\"div\",{className:\"border border-gray-100 rounded-lg p-3 bg-gray-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-medium text-gray-700 mb-1\",children:request.song_title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"by \",request.song_artist,\" \\u2022 \",request.requester_name]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inline-block px-2 py-1 text-xs rounded-full bg-green-100 text-green-800\",children:\"\\u2705 Completed\"}),request.tip_amount&&/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-green-600 mt-1\",children:formatTip(request.tip_amount)})]})]})},request.id))})})]})]})]})});};export default ArtistDashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}